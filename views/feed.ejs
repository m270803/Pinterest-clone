<% include ./partials/header.ejs %>
<div class="w-full min-h-screen bg-zinc-800 px-10 py-8 text-white">
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
        <% posts.forEach(function(elem){ %>
            <div class="card bg-white text-black rounded-lg overflow-hidden shadow-lg transition-transform transform hover:scale-105">
                <div class="w-full h-64 bg-zinc-200 overflow-hidden">
                    <!-- Clickable image to open modal -->
                    <img class="w-full h-full object-cover cursor-pointer" src="/images/uploads/<%= elem.image %>" alt="" onclick="openImageModal('<%= elem.image %>', '<%= elem._id %>', <%= JSON.stringify(elem.likes) %>)">
                </div>
                <div class="p-4">
                    <h5 class="mt-2 text-lg font-semibold"><%= elem.title %></h5>
                    <p class="mt-2 text-sm"><%= elem.description %></p>
                    <p class="opacity-50 font-semibold text-xs mt-2">@<%= elem.user.username %></p>
                    <!-- Like and Unlike buttons -->
                    <% if (user) { %>
                        <% if (elem.likes.includes(user._id)) { %>
                            <form id="unlikeForm-<%= elem._id %>" action="/unlike/<%= elem._id %>" method="POST">
                                <button id="unlikeButton-<%= elem._id %>" type="submit" class="px-3 py-2 bg-red-600 text-white rounded-lg" style="margin-top: 10px;">Unlike (<%= elem.likes.length %>)</button>
                            </form>
                        <% } else { %>
                            <form id="likeForm-<%= elem._id %>" action="/like/<%= elem._id %>" method="POST">
                                <button id="likeButton-<%= elem._id %>" type="submit" class="px-3 py-2 bg-red-600 text-white rounded-lg" style="margin-top: 10px;">Like (<%= elem.likes.length %>)</button>
                            </form>
                        <% } %>
                    <% } else { %>
                        <p class="mt-2 text-sm">Log in to like this post.</p>
                    <% } %>
                </div>
            </div>
        <% }) %>
    </div>
</div>
<% include ./partials/footer.ejs %>

<!-- Bootstrap modal for image display -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-body">
                <img id="modalImage" class="w-full h-auto" src="" alt="">
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<script>
    function openImageModal(imageUrl, postId, likes) {
        $('#modalImage').attr('src', '/images/uploads/' + imageUrl);
        $('#imageModal').modal('show');
    }
</script>
